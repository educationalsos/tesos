{"ast":null,"code":"import { UntypedFormBuilder, Validators } from '@angular/forms';\nimport { SosService } from 'app/sos/sos.service';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { Stakeholder } from 'app/stakeholders/stakeholder';\nimport { StakeholdersService } from 'app/stakeholders/stakeholders.service';\nimport { Constituent } from 'app/constituents/constituent';\nimport { ConstituentsService } from 'app/constituents/constituents.service';\nimport { Service } from 'app/services/service';\nimport { ServicesService } from 'app/services/services.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"app/sos/sos.service\";\nimport * as i4 from \"app/services/services.service\";\nimport * as i5 from \"app/stakeholders/stakeholders.service\";\nimport * as i6 from \"app/constituents/constituents.service\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"@angular/material\";\n\nfunction NewSoSComponent_ng_template_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Upload your Mkaos Models\");\n  }\n}\n\nfunction NewSoSComponent_tr_58_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 39)(4, \"button\", 40);\n    i0.ɵɵlistener(\"click\", function NewSoSComponent_tr_58_Template_button_click_4_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r12);\n      const i_r10 = restoredCtx.index;\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.removeStake(i_r10));\n    });\n    i0.ɵɵelementStart(5, \"i\", 41);\n    i0.ɵɵtext(6, \"close\");\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const stakes_r9 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(stakes_r9.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"matTooltipPosition\", \"above\");\n  }\n}\n\nfunction NewSoSComponent_ng_template_64_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Fill out the services URI for constituents systems capacities\");\n  }\n}\n\nconst _c0 = function () {\n  return {\n    standalone: true\n  };\n};\n\nfunction NewSoSComponent_div_65_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 46);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 47)(4, \"mat-form-field\", 15)(5, \"input\", 48);\n    i0.ɵɵlistener(\"ngModelChange\", function NewSoSComponent_div_65_tr_13_Template_input_ngModelChange_5_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r19);\n      const j_r17 = restoredCtx.index;\n      const i_r14 = i0.ɵɵnextContext().index;\n      const ctx_r18 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r18.model_services[i_r14][j_r17].link = $event);\n    });\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const service_r16 = ctx.$implicit;\n    const j_r17 = ctx.index;\n    const i_r14 = i0.ɵɵnextContext().index;\n    const ctx_r15 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(service_r16.name);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", ctx_r15.model_services[i_r14][j_r17].link)(\"ngModelOptions\", i0.ɵɵpureFunction0(3, _c0));\n  }\n}\n\nfunction NewSoSComponent_div_65_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"div\", 14)(2, \"div\", 3)(3, \"div\", 42)(4, \"div\", 43)(5, \"div\", 44)(6, \"span\", 45);\n    i0.ɵɵtext(7, \"Constituents:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"p\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(10, \"div\", 7)(11, \"table\", 32)(12, \"tbody\");\n    i0.ɵɵtemplate(13, NewSoSComponent_div_65_tr_13_Template, 6, 4, \"tr\", 33);\n    i0.ɵɵelementEnd()()()()()();\n  }\n\n  if (rf & 2) {\n    const model_r13 = ctx.$implicit;\n    const i_r14 = ctx.index;\n    const ctx_r7 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵtextInterpolate(model_r13.name);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r7.model_services[i_r14]);\n  }\n}\n\nfunction NewSoSComponent_ng_template_72_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Done\");\n  }\n}\n\nexport let NewSoSComponent = /*#__PURE__*/(() => {\n  class NewSoSComponent {\n    constructor(_formBuilder, route, router, sosService, servicesService, stakeholderService, constituentService) {\n      this._formBuilder = _formBuilder;\n      this.route = route;\n      this.router = router;\n      this.sosService = sosService;\n      this.servicesService = servicesService;\n      this.stakeholderService = stakeholderService;\n      this.constituentService = constituentService;\n      this.sos = {\n        id: null,\n        name: \"\",\n        description: \"\",\n        mkaos_model: \"\"\n      };\n      this.stakeholder = {\n        name: \"\",\n        sos: null\n      };\n      this.constituent = {\n        id: null,\n        path: \"\",\n        services: null,\n        sos: null\n      };\n      this.mkaos_model_to_upload = null;\n      this.constituents_models_to_upload = [];\n      this.model_services = [];\n      this.stakeholders = [];\n      this.constituents = [];\n    }\n\n    ngOnInit() {\n      this.firstFormGroup = this._formBuilder.group({\n        firstCtrl: ['', Validators.required]\n      });\n      this.secondFormGroup = this._formBuilder.group({\n        secondCtrl: ['', Validators.required]\n      });\n    }\n\n    gotoList() {\n      this.router.navigate(['/list']);\n    }\n\n    save() {\n      this.sosService.save(this.sos).subscribe(result => {\n        this.sos.id = result;\n      }, error => console.error(error), () => {\n        this.saveStake();\n        this.saveConstituentsAndServices();\n        this.router.navigate(['/list']);\n      });\n      this.uploadFile('1', this.mkaos_model_to_upload);\n      this.constituents_models_to_upload.forEach(file => {\n        this.uploadFile('2', file);\n      });\n    }\n\n    remove(href) {\n      this.sosService.remove(href).subscribe(result => {\n        this.gotoList();\n      }, error => console.error(error));\n    }\n\n    addStake() {\n      const aux = new Stakeholder(this.stakeholder.name, null);\n      this.stakeholders.push(aux);\n    }\n\n    removeStake(index) {\n      this.stakeholders.splice(index, 1);\n    }\n\n    saveStake() {\n      this.stakeholders.forEach(stake => {\n        stake.sos = this.sos;\n        this.stakeholderService.save(stake).subscribe(result => {}, error => console.error(error));\n      });\n    }\n\n    saveConstituents() {\n      this.constituents.forEach(model => {\n        this.constituentService.save(model).subscribe(result => {}, error => console.error(error));\n      });\n    }\n\n    saveConstituentsAndServices() {\n      for (let i = 0; i < this.constituents.length; i++) {\n        this.constituents[i].sos = this.sos;\n        this.constituentService.save(this.constituents[i]).subscribe(result => {\n          this.constituents[i].id = result;\n        }, error => console.error(error), () => {\n          for (let j = 0; j < this.model_services[i].length; j++) {\n            this.model_services[i][j].model = this.constituents[i];\n            this.servicesService.save(this.model_services[i][j]).subscribe(result => {}, error => console.error(error));\n          }\n        });\n      }\n    }\n\n    handleMkaosModel(files) {\n      this.mkaos_model_to_upload = files.item(0);\n      this.sos.mkaos_model = \"../uploads/mkaos_models/\" + this.sos.name + \"/\" + files.item(0).name;\n    }\n\n    handleConstituintsModels(files) {\n      for (let i = 0; i < files.length; i++) {\n        this.constituents_models_to_upload.push(files.item(i));\n        const aux = new Constituent(null, \"../uploads/constituents_models/\" + this.sos.name + \"/\" + files.item(i).name, null, null);\n        this.constituents.push(aux);\n      }\n    }\n\n    uploadFile(type, file) {\n      let formData = new FormData();\n      formData.append('file', file);\n      formData.append('name', this.sos.name);\n      formData.append('type', type);\n      this.sosService.upload(formData).subscribe(result => {}, error => console.error(error));\n      ;\n    }\n\n    handleServices() {\n      for (let i = 0; i < this.constituents.length; i++) {\n        this.model_services.push(this.readServices(new Array(), i));\n      }\n    }\n\n    readServices(services, i) {\n      let r = new FileReader();\n      r.readAsText(this.constituents_models_to_upload[i]);\n\n      r.onload = function (e) {\n        var rawLog = r.result;\n        var logLines = rawLog.split(/[\\r\\n]+/);\n        logLines.forEach(line => {\n          var pos = line.indexOf(\"name=\");\n          var line1 = line.indexOf(\"capableOf=\");\n          if (pos > 0 && line1 < 0) services.push(new Service(null, line.slice(pos + 6, -3), \"\", null));\n        });\n      }; //services.shift();\n\n\n      return services;\n    }\n\n  }\n\n  NewSoSComponent.ɵfac = function NewSoSComponent_Factory(t) {\n    return new (t || NewSoSComponent)(i0.ɵɵdirectiveInject(i1.UntypedFormBuilder), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.SosService), i0.ɵɵdirectiveInject(i4.ServicesService), i0.ɵɵdirectiveInject(i5.StakeholdersService), i0.ɵɵdirectiveInject(i6.ConstituentsService));\n  };\n\n  NewSoSComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: NewSoSComponent,\n    selectors: [[\"app-new-so-s\"]],\n    decls: 83,\n    vars: 15,\n    consts: [[1, \"main-content\"], [1, \"container-fluid\"], [1, \"row\"], [1, \"card\"], [1, \"card-header\", \"card-header-danger\"], [1, \"card-title\"], [1, \"card-category\"], [1, \"card-body\"], [\"labelPosition\", \"bottom\"], [\"stepper\", \"\"], [3, \"stepControl\"], [3, \"formGroup\"], [\"sosForm\", \"ng-form\"], [\"matStepLabel\", \"\"], [1, \"col-md-12\"], [1, \"example-full-width\"], [\"matInput\", \"\", \"placeholder\", \"SoS Name\", \"type\", \"text\", \"required\", \"\", \"name\", \"name\", 3, \"ngModel\", \"ngModelOptions\", \"ngModelChange\"], [\"matInput\", \"\", \"placeholder\", \"SoS Description\", \"type\", \"text\", \"required\", \"\", \"name\", \"description\", 3, \"ngModel\", \"ngModelOptions\", \"ngModelChange\"], [1, \"col-md-4\"], [\"matInput\", \"\", \"placeholder\", \"Select your MKaos Model\"], [1, \"col-md-2\"], [\"mat-button\", \"\", \"type\", \"button\", \"color\", \"primary\", 1, \"mat-fab\", \"mat-mini\", 3, \"click\"], [\"data-notify\", \"icon\", 1, \"material-icons\"], [\"hidden\", \"\", \"type\", \"file\", \"name\", \"mkaos_model_to_upload\", \"required\", \"\", 3, \"change\"], [\"fileInput\", \"\"], [\"matInput\", \"\", \"placeholder\", \"Select your Contituents Model\"], [\"hidden\", \"\", \"type\", \"file\", \"name\", \"constituints_models\", \"required\", \"\", \"multiple\", \"\", 3, \"change\"], [\"multipeFileInput\", \"\"], [1, \"col-md-10\"], [\"matInput\", \"\", \"placeholder\", \"Add new stakeholder\", \"type\", \"text\", \"required\", \"\", \"name\", \"name\", 3, \"ngModel\", \"ngModelOptions\", \"ngModelChange\"], [1, \"tab-content\"], [\"id\", \"profile\", 1, \"tab-pane\", \"active\"], [1, \"table\"], [4, \"ngFor\", \"ngForOf\"], [\"mat-raised-button\", \"\", \"matStepperNext\", \"\", 1, \"btn\", \"btn-danger\", 3, \"click\"], [\"optional\", \"\", 3, \"stepControl\"], [\"class\", \"row\", 4, \"ngFor\", \"ngForOf\"], [\"mat-raised-button\", \"\", \"matStepperPrevious\", \"\", 1, \"btn\", \"btn-danger\"], [\"mat-raised-button\", \"\", \"matStepperNext\", \"\", 1, \"btn\", \"btn-danger\"], [1, \"td-actions\", \"text-right\"], [\"mat-raised-button\", \"\", \"type\", \"button\", \"matTooltip\", \"Remove\", 1, \"btn\", \"btn-danger\", \"btn-link\", \"btn-sm\", \"btn-just-icon\", 3, \"matTooltipPosition\", \"click\"], [1, \"material-icons\"], [1, \"card-header\"], [1, \"nav-tabs-navigation\"], [1, \"nav-tabs-wrapper\"], [1, \"nav-tabs-title\"], [\"width\", \"20%\"], [\"width\", \"80%\"], [\"matInput\", \"\", \"placeholder\", \"To send video streaming URI\", \"type\", \"text\", \"required\", \"\", \"name\", \"path\", 3, \"ngModel\", \"ngModelOptions\", \"ngModelChange\"]],\n    template: function NewSoSComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r22 = i0.ɵɵgetCurrentView();\n\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4)(5, \"h4\", 5);\n        i0.ɵɵtext(6, \"New SoS\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"p\", 6);\n        i0.ɵɵtext(8, \"Follow the steps below\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(9, \"div\", 7)(10, \"mat-horizontal-stepper\", 8, 9)(12, \"mat-step\", 10)(13, \"form\", 11, 12);\n        i0.ɵɵtemplate(15, NewSoSComponent_ng_template_15_Template, 1, 0, \"ng-template\", 13);\n        i0.ɵɵelementStart(16, \"div\", 2)(17, \"div\", 14)(18, \"mat-form-field\", 15)(19, \"input\", 16);\n        i0.ɵɵlistener(\"ngModelChange\", function NewSoSComponent_Template_input_ngModelChange_19_listener($event) {\n          return ctx.sos.name = $event;\n        });\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(20, \"div\", 2)(21, \"div\", 14)(22, \"mat-form-field\", 15)(23, \"input\", 17);\n        i0.ɵɵlistener(\"ngModelChange\", function NewSoSComponent_Template_input_ngModelChange_23_listener($event) {\n          return ctx.sos.description = $event;\n        });\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(24, \"div\", 2)(25, \"div\", 18)(26, \"mat-form-field\", 15);\n        i0.ɵɵelement(27, \"input\", 19);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(28, \"div\", 20)(29, \"button\", 21);\n        i0.ɵɵlistener(\"click\", function NewSoSComponent_Template_button_click_29_listener() {\n          i0.ɵɵrestoreView(_r22);\n\n          const _r3 = i0.ɵɵreference(33);\n\n          return i0.ɵɵresetView(_r3.click());\n        });\n        i0.ɵɵelementStart(30, \"i\", 22);\n        i0.ɵɵtext(31, \"attach_file\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(32, \"input\", 23, 24);\n        i0.ɵɵlistener(\"change\", function NewSoSComponent_Template_input_change_32_listener($event) {\n          return ctx.handleMkaosModel($event.target.files);\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(34, \"div\", 18)(35, \"mat-form-field\", 15);\n        i0.ɵɵelement(36, \"input\", 25);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(37, \"div\", 20)(38, \"button\", 21);\n        i0.ɵɵlistener(\"click\", function NewSoSComponent_Template_button_click_38_listener() {\n          i0.ɵɵrestoreView(_r22);\n\n          const _r4 = i0.ɵɵreference(42);\n\n          return i0.ɵɵresetView(_r4.click());\n        });\n        i0.ɵɵelementStart(39, \"i\", 22);\n        i0.ɵɵtext(40, \"attach_file\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(41, \"input\", 26, 27);\n        i0.ɵɵlistener(\"change\", function NewSoSComponent_Template_input_change_41_listener($event) {\n          return ctx.handleConstituintsModels($event.target.files);\n        });\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(43, \"div\", 2)(44, \"div\", 28)(45, \"mat-form-field\", 15)(46, \"input\", 29);\n        i0.ɵɵlistener(\"ngModelChange\", function NewSoSComponent_Template_input_ngModelChange_46_listener($event) {\n          return ctx.stakeholder.name = $event;\n        });\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(47, \"div\", 20)(48, \"button\", 21);\n        i0.ɵɵlistener(\"click\", function NewSoSComponent_Template_button_click_48_listener() {\n          return ctx.addStake();\n        });\n        i0.ɵɵelementStart(49, \"i\", 22);\n        i0.ɵɵtext(50, \"add_box\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(51, \"div\", 2)(52, \"div\", 14)(53, \"div\", 7)(54, \"div\", 30)(55, \"div\", 31)(56, \"table\", 32)(57, \"tbody\");\n        i0.ɵɵtemplate(58, NewSoSComponent_tr_58_Template, 7, 2, \"tr\", 33);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(59, \"div\")(60, \"button\", 34);\n        i0.ɵɵlistener(\"click\", function NewSoSComponent_Template_button_click_60_listener() {\n          return ctx.handleServices();\n        });\n        i0.ɵɵtext(61, \" Next \");\n        i0.ɵɵelementEnd()()()()()()();\n        i0.ɵɵelementStart(62, \"mat-step\", 35)(63, \"form\", 11);\n        i0.ɵɵtemplate(64, NewSoSComponent_ng_template_64_Template, 1, 0, \"ng-template\", 13);\n        i0.ɵɵtemplate(65, NewSoSComponent_div_65_Template, 14, 2, \"div\", 36);\n        i0.ɵɵelementStart(66, \"div\")(67, \"button\", 37);\n        i0.ɵɵtext(68, \" Back \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(69, \"button\", 38);\n        i0.ɵɵtext(70, \" Next \");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(71, \"mat-step\");\n        i0.ɵɵtemplate(72, NewSoSComponent_ng_template_72_Template, 1, 0, \"ng-template\", 13);\n        i0.ɵɵelementStart(73, \"h3\");\n        i0.ɵɵtext(74, \"You are now done.\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(75, \"br\")(76, \"br\");\n        i0.ɵɵelementStart(77, \"div\")(78, \"button\", 37);\n        i0.ɵɵtext(79, \" Back \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(80, \"a\")(81, \"button\", 34);\n        i0.ɵɵlistener(\"click\", function NewSoSComponent_Template_button_click_81_listener() {\n          return ctx.save();\n        });\n        i0.ɵɵtext(82, \" Finish \");\n        i0.ɵɵelementEnd()()()()()()()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"stepControl\", ctx.firstFormGroup);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"formGroup\", ctx.firstFormGroup);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngModel\", ctx.sos.name)(\"ngModelOptions\", i0.ɵɵpureFunction0(12, _c0));\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngModel\", ctx.sos.description)(\"ngModelOptions\", i0.ɵɵpureFunction0(13, _c0));\n        i0.ɵɵadvance(23);\n        i0.ɵɵproperty(\"ngModel\", ctx.stakeholder.name)(\"ngModelOptions\", i0.ɵɵpureFunction0(14, _c0));\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"ngForOf\", ctx.stakeholders);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"stepControl\", ctx.secondFormGroup);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"formGroup\", ctx.secondFormGroup);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.constituents_models_to_upload);\n      }\n    },\n    dependencies: [i7.NgForOf, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.RequiredValidator, i1.NgModel, i1.FormGroupDirective, i8.MatButton, i8.MatFormField, i8.MatInput, i8.MatTooltip, i8.MatHorizontalStepper, i8.MatStep, i8.MatStepLabel, i8.MatStepperNext, i8.MatStepperPrevious]\n  });\n  return NewSoSComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}